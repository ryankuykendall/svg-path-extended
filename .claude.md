# svg-path-extended

A TypeScript module that extends SVG path syntax with variables, expressions, control flow, and functions.

## Project Structure

```
src/
├── parser/
│   ├── ast.ts         # AST node type definitions
│   └── index.ts       # Parsimmon-based parser
├── evaluator/
│   └── index.ts       # AST evaluator → SVG path strings
├── stdlib/
│   ├── math.ts        # Math functions (sin, cos, lerp, etc.)
│   ├── path.ts        # Path helpers (circle, rect, polygon, star)
│   └── index.ts       # Stdlib exports
├── cli.ts             # CLI entry point
└── index.ts           # Library entry point

tests/
├── parser.test.ts     # Parser unit tests
└── evaluator.test.ts  # Evaluator/integration tests

examples/
├── output/            # Generated SVG files for visual inspection
└── *.svgx             # Example source files
```

## Commands

```bash
npm run build      # Build production bundles (ESM, CJS, browser)
npm run dev        # Build with watch mode
npm test           # Run tests in watch mode
npm run test:run   # Run tests once
npm run cli        # Run CLI in development (via tsx)
```

## Syntax Overview

```
// Variables
let radius = 50;
let cx = 100;

// Plain variables in path commands
M cx cy

// Math expressions require calc()
L calc(cx + 10) calc(cy * 2)

// For loops
for (i in 0..10) {
  L calc(i * 20) calc(sin(i) * 30)
}

// If statements
if (x > 0) { M 10 10 } else { M 0 0 }

// User-defined functions
fn myShape(x, y, size) {
  rect(x, y, size, size)
}

// Stdlib functions
circle(cx, cy, r)
polygon(cx, cy, radius, sides)
star(cx, cy, outerR, innerR, points)

// Comments
// This is a line comment
M 0 0  // inline comment
```

## CLI Usage

```bash
# Compile from file
svg-path-extended input.svgx
svg-path-extended --src=input.svgx

# Compile inline code
svg-path-extended -e 'circle(100, 100, 50)'

# Output as complete SVG file
svg-path-extended --src=input.svgx --output-svg-file=output.svg

# SVG styling options
--stroke=<color>       # Stroke color (default: #000)
--fill=<color>         # Fill color (default: none)
--stroke-width=<n>     # Stroke width (default: 2)
--viewBox=<box>        # SVG viewBox (default: 0 0 200 200)
--width=<w>            # SVG width (default: 200)
--height=<h>           # SVG height (default: 200)
```

## Architecture Notes

- **Parser**: Uses Parsimmon parser combinators. The grammar handles operator precedence via chained expression parsers (or → and → equality → comparison → additive → multiplicative → unary → primary).

- **Path commands vs identifiers**: Single uppercase/lowercase letters that are SVG path commands (M, L, C, A, Z, etc.) cannot be used as variable names in path argument positions to avoid ambiguity.

- **calc()**: Required for math expressions in path arguments. Plain identifiers work without calc() for simple variable references.

- **User functions**: Return PathSegment objects that get stringified when used in path context.

## Testing

When adding new features:
1. Add parser tests in `tests/parser.test.ts` for syntax
2. Add evaluator tests in `tests/evaluator.test.ts` for behavior
3. Generate example SVGs with `--output-svg-file` for visual verification
