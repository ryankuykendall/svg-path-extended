# svg-path-extended

A TypeScript module that extends SVG path syntax with variables, expressions, control flow, and functions.

## Documentation

End-user documentation lives in `docs/`:

- `docs/syntax.md` - Language syntax reference
- `docs/stdlib.md` - Standard library functions
- `docs/cli.md` - CLI usage and options
- `docs/examples.md` - Practical examples and recipes

## Project Structure

```
src/
├── parser/
│   ├── ast.ts         # AST node type definitions
│   └── index.ts       # Parsimmon-based parser
├── evaluator/
│   └── index.ts       # AST evaluator → SVG path strings
├── stdlib/
│   ├── math.ts        # Math functions (sin, cos, lerp, etc.)
│   ├── path.ts        # Path helpers (circle, rect, polygon, star)
│   └── index.ts       # Stdlib exports
├── cli.ts             # CLI entry point
└── index.ts           # Library entry point

tests/
├── parser.test.ts     # Parser unit tests
└── evaluator.test.ts  # Evaluator/integration tests

examples/
├── output/            # Generated SVG files for visual inspection
└── *.svgx             # Example source files

docs/                  # End-user documentation
```

## Commands

```bash
npm run build      # Build production bundles (ESM, CJS, browser)
npm run dev        # Build with watch mode
npm test           # Run tests in watch mode
npm run test:run   # Run tests once
npm run cli        # Run CLI in development (via tsx)
```

## Architecture Notes

- **Parser**: Uses Parsimmon parser combinators. The grammar handles operator precedence via chained expression parsers (or → and → equality → comparison → additive → multiplicative → unary → primary).

- **Path commands vs identifiers**: Single uppercase/lowercase letters that are SVG path commands (M, L, C, A, Z, etc.) cannot be used as variable names in path argument positions to avoid ambiguity.

- **calc()**: Required for math expressions in path arguments. Plain identifiers work without calc() for simple variable references.

- **User functions**: Return PathSegment objects that get stringified when used in path context.

## Development Workflow

Follow this process for all new features and enhancements:

### 1. Documentation First

Before writing any code, write end-user documentation:

- Update the appropriate file in `docs/` (syntax.md, stdlib.md, cli.md, or examples.md)
- Write from the user's perspective: What problem does this solve? How do they use it?
- Include clear examples showing the feature in action

**Exception**: Bug fixes for existing functionality can skip this step.

### 2. Write Tests/Specs

Before implementation, write failing tests that define the expected behavior:

- Parser tests in `tests/parser.test.ts` for new syntax
- Evaluator tests in `tests/evaluator.test.ts` for runtime behavior
- Tests should cover both success cases and error cases

### 3. Implementation

Only after documentation and tests are in place:

- Implement the feature to make tests pass
- Generate example SVGs with `--output-svg-file` for visual verification
- Run full test suite to ensure no regressions

### Bug Fixes

For bugs in existing functionality:

1. Write a failing test that reproduces the bug
2. Fix the bug
3. Verify the test passes
